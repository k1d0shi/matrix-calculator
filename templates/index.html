<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ç—Ä–∏—Ü</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<header>
    <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ç—Ä–∏—Ü</h1>
</header>

<main>
    <div class="matrix-container"
         style="display: flex; justify-content: space-between; align-items: center; width: 80%; margin: 0 auto; position: relative;">

        <div class="matrix left-matrix">
            <h2>–ú–∞—Ç—Ä–∏—Ü–∞ A</h2>
            <label>–†–∞–∑–º–µ—Ä:
                <select id="sizeA" onchange="generateMatrix('A')">
                    <option value="2">2x2</option>
                    <option value="3" selected>3x3</option>
                    <option value="4">4x4</option>
                </select>
            </label>
            <div id="matrixA"></div>
        </div>

        <button onclick="swapMatrices()" class="swap-button"
                style="position:absolute; left:50%; top:45%; transform:translate(-50%, -50%); font-size:30px;">
            üîÅ
        </button>

        <div class="matrix right-matrix">
            <h2>–ú–∞—Ç—Ä–∏—Ü–∞ B</h2>
            <label>–†–∞–∑–º–µ—Ä:
                <select id="sizeB" onchange="generateMatrix('B')">
                    <option value="2">2x2</option>
                    <option value="3" selected>3x3</option>
                    <option value="4">4x4</option>
                </select>
            </label>
            <div id="matrixB"></div>
        </div>
    </div>

    <div class="operation">
        <label>–û–ø–µ—Ä–∞—Ü–∏—è:
            <select id="operation">
                <option value="add">A + B (—Å–ª–æ–∂–µ–Ω–∏–µ)</option>
                <option value="sub">A - B (–≤—ã—á–∏—Ç–∞–Ω–∏–µ)</option>
                <option value="mul">A √ó B (—É–º–Ω–æ–∂–µ–Ω–∏–µ)</option>
                <option value="det a">det A</option>
                <option value="det b">det B</option>
                <option value="rankA">–†–∞–Ω–≥ A</option>
                <option value="rankB">–†–∞–Ω–≥ B</option>
                <option value="invA">A‚Åª¬π (–æ–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞)</option>
                <option value="invB">B‚Åª¬π (–æ–±—Ä–∞—Ç–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞)</option>
            </select>
        </label>
        <button onclick="calculate()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
    </div>

    <div id="result"></div>
</main>

<script>
    function generateMatrix(id) {
        const size = parseInt(document.getElementById("size" + id).value);
        const container = document.getElementById("matrix" + id);
        container.innerHTML = "";
        for (let i = 0; i < size; i++) {
            const row = document.createElement("div");
            row.classList.add("row");
            for (let j = 0; j < size; j++) {
                const input = document.createElement("input");
                input.type = "number";
                input.value = "0";
                input.classList.add("cell");
                row.appendChild(input);
            }
            container.appendChild(row);
        }
    }

    function getMatrix(id) {
        const inputs = document.querySelectorAll(`#matrix${id} input`);
        const size = Math.sqrt(inputs.length);
        const matrix = [];
        for (let i = 0; i < size; i++) {
            const row = [];
            for (let j = 0; j < size; j++) {
                const value = parseFloat(inputs[i * size + j].value);
                row.push(isNaN(value) ? 0 : value);
            }
            matrix.push(row);
        }
        return matrix;
    }

    function swapMatrices() {
        const aInputs = document.querySelectorAll("#matrixA input");
        const bInputs = document.querySelectorAll("#matrixB input");
        if (aInputs.length !== bInputs.length) {
            alert("–ú–∞—Ç—Ä–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞!");
            return;
        }
        for (let i = 0; i < aInputs.length; i++) {
            const tmp = aInputs[i].value;
            aInputs[i].value = bInputs[i].value;
            bInputs[i].value = tmp;
        }
    }

    async function calculate() {
        const A = getMatrix("A");
        const B = getMatrix("B");
        const operation = document.getElementById("operation").value;

        const response = await fetch("/calculate", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({A, B, operation})
        });

        const data = await response.json();
        const resultDiv = document.getElementById("result");

        if (data.error) {
            resultDiv.innerHTML = `<p class="error-text">${data.error}</p>`;
        } else {
            let html = "<h2>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h2><table>";
            data.result.forEach(row => {
                html += "<tr>" + row.map(x => `<td>${x}</td>`).join("") + "</tr>";
            });
            html += "</table>";
            resultDiv.innerHTML = html;
        }
    }

    generateMatrix("A");
    generateMatrix("B");
</script>
</body>
</html>
