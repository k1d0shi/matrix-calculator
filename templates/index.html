<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Калькулятор матриц</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .swap-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 60px;
        }
        .swap-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background-color: #4CAF50;
            border: none;
            padding: 0;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        .swap-button img {
            display: block;
            width: 34px;
            height: 34px;
            margin: 0;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <header>Калькулятор матриц</header>

    <form method="POST" action="/">
        <div class="container">
            <div class="matrix">
                <h2>Матрица A</h2>
                <label>Размер:
                    <select name="size_a" id="size_a" onchange="updateMatrix('A')">
                        <option value="2">2×2</option>
                        <option value="3" selected>3×3</option>
                        <option value="4">4×4</option>
                    </select>
                </label>
                <div id="matrixA"></div>
            </div>

            <div class="swap-container">
                <button type="button" class="swap-button" onclick="swapMatrices()">
                    <img src="https://cdn-icons-png.flaticon.com/512/860/860790.png" alt="swap">
                </button>
            </div>

            <div class="matrix">
                <h2>Матрица B</h2>
                <label>Размер:
                    <select name="size_b" id="size_b" onchange="updateMatrix('B')">
                        <option value="2">2×2</option>
                        <option value="3" selected>3×3</option>
                        <option value="4">4×4</option>
                    </select>
                </label>
                <div id="matrixB"></div>
            </div>
        </div>

        <div class="controls">
            <label for="operation"><b>Операция:</b></label>
            <select name="operation" id="operation">
                <option value="add">A + B (сложение)</option>
                <option value="subtract">A − B (вычитание)</option>
                <option value="multiply">A × B (умножение)</option>
                <option value="inverse_A">A⁻¹ (обратная A)</option>
                <option value="inverse_B">B⁻¹ (обратная B)</option>
                <option value="rank_A">Ранг матрицы A</option>
                <option value="rank_B">Ранг матрицы B</option>
                <option value="divisor_A">НОД матрицы A</option>
                <option value="divisor_B">НОД матрицы B</option>
            </select>
            <button type="submit">Вычислить</button>
        </div>

        {% if error %}
        <div class="result error">
            <h3>Ошибка:</h3>
            <p>{{ error }}</p>
        </div>
        {% endif %}

        {% if result is not none %}
        <div class="result">
            <h3>Результат:</h3>
            <p>{{ result }}</p>
        </div>
        {% endif %}
    </form>

    <script>
        function createMatrixInputs(id, size) {
            let matrixDiv = document.getElementById("matrix" + id);
            matrixDiv.innerHTML = "";
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    let input = document.createElement("input");
                    input.type = "number";
                    input.name = id + i + j;
                    input.value = 0;
                    input.step = "any";
                    matrixDiv.appendChild(input);
                }
                matrixDiv.appendChild(document.createElement("br"));
            }
        }

        function updateMatrix(id) {
            let size = parseInt(document.getElementById("size_" + id.toLowerCase()).value);
            createMatrixInputs(id, size);
        }

        function swapMatrices() {
            const aArea = document.getElementById("matrixA").innerHTML;
            const bArea = document.getElementById("matrixB").innerHTML;
            document.getElementById("matrixA").innerHTML = bArea;
            document.getElementById("matrixB").innerHTML = aArea;

            // также меняем значения size
            const sizeSelectA = document.getElementById("size_a");
            const sizeSelectB = document.getElementById("size_b");
            const tempSize = sizeSelectA.value;
            sizeSelectA.value = sizeSelectB.value;
            sizeSelectB.value = tempSize;
        }

        window.onload = function() {
            updateMatrix('A');
            updateMatrix('B');
        };
    </script>
</body>
</html>
